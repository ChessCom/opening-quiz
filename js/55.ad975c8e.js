"use strict";(self["webpackChunkopening_quiz"]=self["webpackChunkopening_quiz"]||[]).push([[55],{399:function(t,e,n){var o;n.d(e,{Or:function(){return a},hm:function(){return r},xF:function(){return i}}),(t=>{(t=>{t.Name="custom-items"})(t.Plugin||(t.Plugin={})),(t=>{t["Root"]="custom-item"})(t.Classes||(t.Classes={}))})(o||(o={}));const r="customItem";var i;(t=>{(t=>{t["Arrows"]="arrows",t["Effects"]="effects",t["Pieces"]="pieces"})(t.Targets||(t.Targets={})),(t=>{t["Above"]="above",t["Below"]="below"})(t.Positions||(t.Positions={}))})(i||(i={}));var a=(t=>(t["Image"]="Image",t["Star"]="Star",t["TextBox"]="TextBox",t))(a||{})},7247:function(t,e,n){function o(t){return{file:t.toLowerCase().charCodeAt(0)-96,rank:Number(t.charAt(1))}}n.d(e,{Z:function(){return o}})},2198:function(t,e,n){n.d(e,{k:function(){return u}});var o=n(6352),r=n(813);function i(t,e){return function(n){const o=Object.entries(n).map((([n,o])=>{var r;if(!o||!(null==(r=t.overridableMethods)?void 0:r.includes(n)))return;const i=t[n];return t[n]=o(t,e),function(){t[n]=i}}));return function(){o.map((t=>null==t?void 0:t()))}}}function a({base:t,initialOptions:e}){return function(n){const a=Object.keys(e).reduce(((t,n)=>(t[n]=e[n].default,t)),{}),u=t({api:n,options:a}),c=i(u,n);return Object.assign(u,{extendMode:c,getOptions:l,setOption:f});function l(){return a}function f(t,i){var u;(null==(u=e[t])?void 0:u.editable)?(a[t]=i,n.emit(o.i.OptionsEvents.UpdateMode,(0,r.e)(o.i.OptionsEvents.UpdateMode,{[t]:i}))):s(t)}}}function u(t,e){return function(n={}){const o=Object.keys(n).reduce(((t,o)=>{var r;return(null==(r=e[o])?void 0:r.editable)?Object.assign(t,{[o]:{default:n[o],editable:!0}}):s(o),t}),e);return a({base:t,initialOptions:o})}}function s(t){console.warn(`${t} is not an editable option in this mode.`)}},55:function(t,e,n){n.r(e),n.d(e,{create:function(){return U}});var o,r=n(2198);(t=>{(t=>{t["Completed"]="CTSCompleted"})(t.Events||(t.Events={})),(t=>{t.Name="captureTheStar"})(t.Plugin||(t.Plugin={}))})(o||(o={}));var i=n(6352);function a(t){return function(e){t.config.set("items",e)}}var u=n(5142);function s(t){return function(){var e;return(null==(e=t.getHistorySANs())?void 0:e.length)-1||0}}function c(t,e){return function(){const n=t.captureTheStar;return{completed:e.status.get("completed")||!1,completedMoveCount:e.status.get("completedMoveCount"),itemsRemaining:n.getNumItemsRemaining(),moveCount:n.getCurrentMoveCount()}}}var l=n(399);function f(t){return function e(n={}){const{api:o,game:r}=t,i=o.markings,{previousNode:a}=n;let u=[];if(a){const t=r.ids();r.moveBackward(),u=e(),r.selectPosition(t.move,t.line)}else u=i.getAllWhere({types:[l.hm]});return u}}function d(t){return function(){const e=t.captureTheStar;return e.getItems().map((t=>t.data.square))}}const m={noFromSquareOnMoveObj:'Move object has no "from" square.',cannotLoadWithoutItems:"Cannot load without any items.",cannotLoadWithoutPiece:"Cannot load without a piece.",configurationMissingForItem:"Configuration missing for custom item"};n(4114);var p=n(7247);function g(t,e){const{file:n,rank:o}=(0,p.Z)(t),{file:r,rank:i}=(0,p.Z)(e),a="abcdefgh",u="12345678";if(n===r)return v(o,i).map((t=>`${a.charAt(n-1)}${u.charAt(t-1)}`));if(o===i)return v(n,r).map((t=>`${a.charAt(t-1)}${u.charAt(o-1)}`));if(Math.abs(r-n)!==Math.abs(i-o))throw new Error("Squares are not on same file, rank, or diagonal");const s=v(n,r),c=v(o,i);return s.reduce(((t,e,n)=>(t.push(`${a.charAt(e-1)}${u.charAt(c[n]-1)}`),t)),[])}function v(t,e){const[n,o]=[t,e].sort();return Array(o-n-1).fill(void 0).map(((t,e)=>n+e+1))}function h(t){return function(e){const n=t.captureTheStar,{from:o,to:r}=e;if(!o)throw new Error(m.noFromSquareOnMoveObj);let i=[];return i="n"===e.piece.toLowerCase()?[r]:[r,...g(o,r)],n.getItems({previousNode:!0}).filter((t=>!i.includes(t.data.square)))}}function M(t){return function(){const e=t.captureTheStar;return Object.keys(e.getItems()).length}}function C(t){return function(){return Boolean(t.status.get("completed"))}}function A(t,e,n){const o=null==t?void 0:t[n];if(!l.Or[n]&&!o)return null;const r={data:{square:e,type:o?l.Or.Image:l.Or.Star},node:!0,persistent:!0,type:l.hm,key:`cts-${e}`};return o&&(r.data.image={url:o}),r}function b(t,e){return function(n){const{items:o,piece:r}=n,{api:a,game:u,respond:s}=t,c=a.captureTheStar,l=a.markings;if(!Object.keys(o).length)throw new Error(m.cannotLoadWithoutItems);if(!r)throw new Error(m.cannotLoadWithoutPiece);return a.clearMarkings(),u.load("8/8/8/8/8/8/8/8"),u.put(r,r.square),Object.entries(o).forEach((([t,n])=>{const o=A(e.config.get("items"),t,n);if(!o)throw new Error(m.configurationMissingForItem);l.addOne(o)})),a.setPlayingAs(r.color),a.setTurn(r.color),c.resetPuzzleStatus(),s(i.i.APIEvents.Load,{pieces:a.getPieces()})}}function w(t){return function(){t.status.set("completed",!1),t.status.delete("completedMoveCount")}}function k(t,e){return function(){const n=t.captureTheStar;0!==n.getNumItemsRemaining()||n.isCompleted()||(e.status.set("completed",!0),e.status.set("completedMoveCount",n.getCurrentMoveCount()),n.emit(o.Events.Completed,n.getData()))}}const{createEventEmitter:I}=u.rG;function P(t){const{api:e}=t,n=I(),o=i();o.config.set("items",{});const r=w(o);return r(),{configureItems:a(o),getCurrentMoveCount:s(e),getData:c(e,o),getItems:f(t),getItemSquares:d(e),getNextItems:h(e),getNumItemsRemaining:M(e),...n,isCompleted:C(o),load:b(t,o),resetPuzzleStatus:r,updatePuzzleStatus:k(e,o)};function i(){const t=new Map,e=new Map;return{config:t,status:e}}}var O=n(3496),y=n(6886),S=n(2071);function E(t,e,n){const o=(0,y.T)(e.color)===S.Z.ColorsAsNumbers.Black?"p":"P",r=e.color===S.Z.ColorsAsNumbers.Black?e.type:e.type.toUpperCase(),i=new Array(8).fill(void 0).map((()=>new Array(8).fill(".")));return i[8-e.rank][e.file-1]=r,t.reduce(((t,e)=>{const{file:n,rank:r}=(0,p.Z)(e);return n&&r?(t[8-r][n-1]=o,t):t}),i).map((t=>t.join("").replace(/(\.+)/g,(t=>t.length.toString())))).join("/").concat(` ${(0,O.e)(n)}`)}function T(t,e){return[...new Map(t.map((t=>[t[e],t]))).values()]}var L=n(8387);function N(t){const{api:e,game:n}=t,o=e.getLegalMoves;return function(){const t=e.captureTheStar,r=e.getPlayingAs();if(!r)return[];const i=o(),a=n.getPieces(!1)[0];if(!a||"p"!==a.type)return i;const u=E(t.getItemSquares(),a,r),s=L.A.getLegalMoves(u);return T([...i,...s],"san")}}function B(t){const{api:e}=t,n=e.getMove;return function(t){const o=n(t);return o||(e.getLegalMoves().find((e=>e.to===t.to))??null)}}n(9479);var q=n(8282),j=n(2446);function x(t){const{api:e,game:n}=t,o=e.move;return function(t){if(!e.isAtEndOfLine())return e.selectLineEnd();const r=(0,q.B)(t,e.getFEN(),e.getVariant());if(!r||!r.userGenerated||!("flags"in r))return o(t);const i=(0,j.B)(r)&&"p"===r.piece;return i&&n.put({type:"p",color:(0,y.T)(r.color)},r.to),o(t)}}function z(t){return function(){var e;const{respond:n,game:o,mutateGame:r}=t,a=r((function(){o.moveBackward()}));return!a||0===a.lineDiff&&0===a.plyDiff?n(i.i.APIEvents.MoveBackward,null):((null==(e=a.move)?void 0:e.captured)&&(a.move.captured=void 0),n(i.i.APIEvents.MoveBackward,a))}}var Z=n(4863),$=n(5271),W=n(8573);function F(t){return{api:P,apiOverrides:{getLegalMoves:N,getMove:B,move:x,moveBackward:z},create:e,match:[{condition:(0,$.E)(W.n),handler:r},{condition:(0,Z.is)(i.i.APIEvents.Move),handler:n}],name:o.Plugin.Name};function e(e){const{api:n}=e,o=n.captureTheStar;t&&o.configureItems(t.items)}function n(t,e){const{api:n,queue:o}=e,r=n.captureTheStar,i=n.markings,a=n.getContext().game,u=r.getNextItems(t.data.move);o.add((function(){o.add((function(){i.addMany(u),a.turn(n.getPlayingAs()),r.updatePuzzleStatus()}))}))}function r(t,e){const{api:n,queue:o}=e,r=n.getPlayingAs();r&&o.add(n.setTurn,r)}}var R=n(805),D=n(1495);function G({api:t}){return{isAllowedToMove:e,handleIllegalMove:(0,R.I)(t),name:D.d.Types.CaptureTheStar,plugins:[F()],usePlayingAs:!0};function e(){return!0}}const U=(0,r.k)(G,{canAddMovesToMainLine:{default:!0,editable:!1},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!1,editable:!1}})},805:function(t,e,n){function o(t){return function(){t.isAtEndOfLine()||t.selectLineEnd()}}n.d(e,{I:function(){return o}})},3496:function(t,e,n){n.d(e,{e:function(){return r}});var o=n(2071);function r(t){return t===o.Z.ColorsAsNumbers.Black?o.Z.ColorsAsLetters.Black:o.Z.ColorsAsLetters.White}}}]);
//# sourceMappingURL=55.ad975c8e.js.map